---
import MenuItem from "./MenuItem.astro";
import menuIcon from "../../assets/menu-icon.svg";
import closeIcon from "../../assets/close-icon.svg";
import { Image } from "astro:assets";
import MenuItemMobile from "./MenuItemMobile.astro";
---

<!-- NAV DESKTOP -->
<nav class="hidden md:block">
  <ul class="flex justify-end gap-6 text-slate-800">
    <MenuItem
      link="/"
      label="Inicio"
    />
    <MenuItem
      link="/silos"
      label="Silos"
      isSubMenu={true}
    />
    <MenuItem
      link="/contacto"
      label="Contacto"
    />
  </ul>
</nav>

<!-- NAV MOBILE -->
<nav class="block md:hidden">
  <div
    id="menu-toggle"
    class="cursor-pointer z-50 relative w-7 h-7">
    <Image
      src={menuIcon}
      alt="Abrir menú"
      width={28}
      id="icon-menu"
      class="absolute top-0 left-0 transition-opacity duration-200 opacity-100"
    />
    <Image
      src={closeIcon}
      alt="Cerrar menú"
      width={28}
      id="icon-close"
      class="absolute top-0 left-0 transition-opacity duration-200 opacity-0"
    />
  </div>

  <ul
    id="mobile-menu-ul"
    class="hidden flex-col items-end absolute right-0 top-20 w-screen text-slate-800 p-6 shadow-lg z-40 opacity-0 translate-y-2 transition-all duration-300 ease-out bg-slate-800 gap-3">
    <MenuItemMobile
      link="/"
      label="Inicio"
      styles="border-b-stone-200"
    />
    <MenuItemMobile
      link="/silos"
      label="Silos"
      isSubMenu={true}
    />
    <MenuItemMobile
      link="/contacto"
      label="Contacto"
    />
  </ul>
</nav>

<script>
  const toggleBtn = document.getElementById("menu-toggle");
  const iconMenu = document.getElementById("icon-menu");
  const iconClose = document.getElementById("icon-close");
  const mobileMenu = document.getElementById("mobile-menu-ul");
  const menuLinks = mobileMenu?.querySelectorAll("a");
  let isOpen = false;

  const openMenu = () => {
    mobileMenu?.classList.remove("hidden", "opacity-0", "translate-y-2");
    mobileMenu?.classList.add("flex", "opacity-100", "translate-y-0");

    // Cambiar íconos usando opacidad
    iconMenu?.classList.remove("opacity-100");
    iconMenu?.classList.add("opacity-0");

    iconClose?.classList.remove("opacity-0");
    iconClose?.classList.add("opacity-100");

    isOpen = true;
  };

  const closeMenu = () => {
    mobileMenu?.classList.add("opacity-0", "translate-y-2");
    setTimeout(() => {
      mobileMenu?.classList.add("hidden");
      mobileMenu?.classList.remove("flex");
    }, 200);

    // Cambiar íconos usando opacidad
    iconMenu?.classList.remove("opacity-0");
    iconMenu?.classList.add("opacity-100");

    iconClose?.classList.remove("opacity-100");
    iconClose?.classList.add("opacity-0");

    isOpen = false;
  };

  toggleBtn?.addEventListener("click", () => {
    isOpen ? closeMenu() : openMenu();
  });

  menuLinks?.forEach((link) => {
    link.addEventListener("click", () => closeMenu());
  });

  document.addEventListener("click", (e) => {
    if (
      isOpen &&
      !mobileMenu?.contains(e.target as Node) &&
      e.target !== toggleBtn &&
      !toggleBtn?.contains(e.target as Node)
    ) {
      closeMenu();
    }
  });
</script>
