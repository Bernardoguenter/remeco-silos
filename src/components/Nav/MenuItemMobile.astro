---
import Image from "astro/components/Image.astro";
import dropDownIconWhite from "../../assets/arrow_drop_down_white.svg";
import silosAereos from "../../assets/silos-aereos.jpg";
import silosComederos from "../../assets/silos-comederos.jpg";
import { Picture } from "astro:assets";

interface Props {
  link: string;
  label: string;
  isSubMenu?: boolean;
  styles?: string;
}

const { link, label, isSubMenu = false, styles = "" } = Astro.props;
---

<li
  class={`uppercase text-slate-800 flex items-center relative ${styles} border-b border-b-stone-200 w-full`}
  id={isSubMenu ? `${label.toLowerCase()}-item` : ""}>
  <a
    href={link}
    class="text-stone-200 md:text-slate-800 text-right w-full">
    {label}
  </a>

  {
    isSubMenu && (
      <>
        <Image
          src={dropDownIconWhite}
          alt="drop down icon"
          width={18}
          height={18}
          id={`${label.toLowerCase()}-arrow`}
          class="inline-block ml-1 md:hidden transition-transform duration-300 cursor-pointer"
        />
      </>
    )
  }
</li>

{
  isSubMenu && (
    <div
      id={`${label.toLowerCase()}-dropdown`}
      class="hidden bg-slate-800 border-b border-b-stone-200 w-full text-white py-2 px-4  items-center gap-4 transition-all duration-300 ease-out">
      <article class="flex flex-col items-center justify-center gap-1">
        <a
          href="/silos/aereos"
          class="text-center">
          <Picture
            alt="silos aéreos"
            src={silosAereos}
            layout="constrained"
            width={220}
            class="rounded"
          />
          Silos Aéreos
        </a>
      </article>
      <article class="flex flex-col items-center justify-center gap-1">
        <a
          href="/silos/comederos"
          class="text-center">
          <Picture
            alt="silos comederos"
            src={silosComederos}
            layout="constrained"
            width={220}
            class="rounded"
          />
          Silos Comederos
        </a>
      </article>
    </div>
  )
}

<script>
  const arrowBtn = document.getElementById(`silos-arrow`);
  const dropdown = document.getElementById(`silos-dropdown`);

  if (arrowBtn && dropdown && window.innerWidth < 1024) {
    let isOpen = false;

    arrowBtn.addEventListener("click", (e) => {
      e.stopPropagation();

      if (!isOpen) {
        // Mostrar menú
        dropdown.classList.remove("hidden");
        dropdown.classList.add("flex");
        arrowBtn.classList.add("rotate-180"); // rota la flecha
        isOpen = true;
      } else {
        // Ocultar menú
        dropdown.classList.add("hidden");
        dropdown.classList.remove("flex");
        arrowBtn.classList.remove("rotate-180");
        isOpen = false;
      }
    });

    // Cerrar si se hace click fuera del menú
    document.addEventListener("click", (e) => {
      if (
        isOpen &&
        !dropdown.contains(e.target as Node) &&
        e.target !== arrowBtn
      ) {
        dropdown.classList.add("hidden");
        dropdown.classList.remove("flex");
        arrowBtn.classList.remove("rotate-180");
        isOpen = false;
      }
    });
  }
</script>
